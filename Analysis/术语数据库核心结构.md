# 术语数据库核心结构

## 概述

本文档实现了术语数据库的核心数据结构，用于统一项目中的术语使用，确保与国际Wiki和学术标准的一致性。

## 1. 核心数据结构

### 1.1 术语定义结构

```rust
use std::collections::HashMap;
use serde::{Deserialize, Serialize};

/// 术语定义
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct TermDefinition {
    /// 术语名称
    pub name: String,
    /// 英文标准名称
    pub english_name: String,
    /// 定义描述
    pub definition: String,
    /// 术语类别
    pub category: TermCategory,
    /// 来源标准
    pub source: TermSource,
    /// 同义词列表
    pub synonyms: Vec<String>,
    /// 上下文信息
    pub context: String,
    /// 使用示例
    pub examples: Vec<String>,
    /// 相关术语
    pub related_terms: Vec<String>,
    /// 置信度 (0.0-1.0)
    pub confidence: f64,
}

/// 术语类别
#[derive(Debug, Clone, Serialize, Deserialize)]
pub enum TermCategory {
    FormalMethods,      // 形式化方法
    ProgrammingLanguage, // 编程语言
    SoftwareArchitecture, // 软件架构
    Concurrency,        // 并发理论
    Verification,       // 形式化验证
    Mathematics,        // 数学理论
    Philosophy,         // 哲学基础
    Other,              // 其他
}

/// 术语来源
#[derive(Debug, Clone, Serialize, Deserialize)]
pub enum TermSource {
    Wikipedia,          // Wikipedia
    AcademicPaper,      // 学术论文
    OfficialDocument,   // 官方文档
    IndustryStandard,   // 行业标准
    ProjectInternal,    // 项目内部
}

/// 标准术语引用
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct StandardReference {
    /// 标准名称
    pub standard_name: String,
    /// 标准版本
    pub version: String,
    /// 引用链接
    pub url: Option<String>,
    /// 定义内容
    pub definition: String,
    /// 发布日期
    pub publication_date: Option<String>,
}
```

### 1.2 术语数据库结构

```rust
/// 术语数据库
#[derive(Debug, Clone)]
pub struct TerminologyDatabase {
    /// 术语定义映射
    terms: HashMap<String, TermDefinition>,
    /// 同义词映射
    synonyms: HashMap<String, Vec<String>>,
    /// 上下文定义
    contexts: HashMap<String, ContextDefinition>,
    /// 标准引用
    standards: HashMap<String, StandardReference>,
    /// 类别索引
    category_index: HashMap<TermCategory, Vec<String>>,
    /// 来源索引
    source_index: HashMap<TermSource, Vec<String>>,
}

/// 上下文定义
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct ContextDefinition {
    /// 上下文名称
    pub name: String,
    /// 上下文描述
    pub description: String,
    /// 适用术语列表
    pub applicable_terms: Vec<String>,
    /// 使用规则
    pub usage_rules: Vec<String>,
}

impl TerminologyDatabase {
    /// 创建新的术语数据库
    pub fn new() -> Self {
        Self {
            terms: HashMap::new(),
            synonyms: HashMap::new(),
            contexts: HashMap::new(),
            standards: HashMap::new(),
            category_index: HashMap::new(),
            source_index: HashMap::new(),
        }
    }

    /// 添加术语定义
    pub fn add_term(&mut self, term: TermDefinition) -> Result<(), String> {
        let name = term.name.clone();
        
        // 验证术语定义
        self.validate_term(&term)?;
        
        // 添加到主映射
        self.terms.insert(name.clone(), term.clone());
        
        // 更新同义词映射
        for synonym in &term.synonyms {
            self.synonyms
                .entry(synonym.clone())
                .or_insert_with(Vec::new)
                .push(name.clone());
        }
        
        // 更新类别索引
        self.category_index
            .entry(term.category.clone())
            .or_insert_with(Vec::new)
            .push(name.clone());
        
        // 更新来源索引
        self.source_index
            .entry(term.source.clone())
            .or_insert_with(Vec::new)
            .push(name.clone());
        
        Ok(())
    }

    /// 验证术语定义
    fn validate_term(&self, term: &TermDefinition) -> Result<(), String> {
        if term.name.is_empty() {
            return Err("术语名称不能为空".to_string());
        }
        
        if term.definition.is_empty() {
            return Err("术语定义不能为空".to_string());
        }
        
        if term.confidence < 0.0 || term.confidence > 1.0 {
            return Err("置信度必须在0.0到1.0之间".to_string());
        }
        
        Ok(())
    }

    /// 查找术语定义
    pub fn find_term(&self, name: &str) -> Option<&TermDefinition> {
        self.terms.get(name)
    }

    /// 通过同义词查找术语
    pub fn find_by_synonym(&self, synonym: &str) -> Option<&TermDefinition> {
        if let Some(terms) = self.synonyms.get(synonym) {
            if let Some(first_term) = terms.first() {
                return self.terms.get(first_term);
            }
        }
        None
    }

    /// 查找标准等价术语
    pub fn find_standard_equivalent(&self, term: &str) -> Option<&StandardReference> {
        self.standards.get(term)
    }

    /// 按类别查找术语
    pub fn find_by_category(&self, category: &TermCategory) -> Vec<&TermDefinition> {
        if let Some(term_names) = self.category_index.get(category) {
            term_names
                .iter()
                .filter_map(|name| self.terms.get(name))
                .collect()
        } else {
            Vec::new()
        }
    }

    /// 按来源查找术语
    pub fn find_by_source(&self, source: &TermSource) -> Vec<&TermDefinition> {
        if let Some(term_names) = self.source_index.get(source) {
            term_names
                .iter()
                .filter_map(|name| self.terms.get(name))
                .collect()
        } else {
            Vec::new()
        }
    }

    /// 搜索术语
    pub fn search_terms(&self, query: &str) -> Vec<&TermDefinition> {
        let query_lower = query.to_lowercase();
        let mut results = Vec::new();
        
        for term in self.terms.values() {
            if term.name.to_lowercase().contains(&query_lower) ||
               term.english_name.to_lowercase().contains(&query_lower) ||
               term.definition.to_lowercase().contains(&query_lower) ||
               term.synonyms.iter().any(|s| s.to_lowercase().contains(&query_lower)) {
                results.push(term);
            }
        }
        
        results
    }

    /// 获取所有术语
    pub fn get_all_terms(&self) -> Vec<&TermDefinition> {
        self.terms.values().collect()
    }

    /// 获取术语总数
    pub fn term_count(&self) -> usize {
        self.terms.len()
    }
}
```

## 2. 标准术语数据

### 2.1 形式化方法术语

```rust
/// 形式化方法术语数据
pub struct FormalMethodsTerms;

impl FormalMethodsTerms {
    /// 获取形式化方法相关术语
    pub fn get_terms() -> Vec<TermDefinition> {
        vec![
            TermDefinition {
                name: "形式化方法".to_string(),
                english_name: "Formal Methods".to_string(),
                definition: "基于数学的技术，用于软件和硬件系统的规范、开发和验证".to_string(),
                category: TermCategory::FormalMethods,
                source: TermSource::Wikipedia,
                synonyms: vec!["Formal Method".to_string(), "Formal Methodology".to_string()],
                context: "Software Engineering".to_string(),
                examples: vec![
                    "Z语言规范".to_string(),
                    "VDM开发方法".to_string(),
                    "B方法".to_string(),
                ],
                related_terms: vec!["形式化规范".to_string(), "形式化验证".to_string()],
                confidence: 0.95,
            },
            TermDefinition {
                name: "形式化规范".to_string(),
                english_name: "Formal Specification".to_string(),
                definition: "使用数学语言精确描述系统行为的文档".to_string(),
                category: TermCategory::FormalMethods,
                source: TermSource::Wikipedia,
                synonyms: vec!["Formal specification".to_string(), "数学规范".to_string()],
                context: "Software Engineering".to_string(),
                examples: vec![
                    "前置条件".to_string(),
                    "后置条件".to_string(),
                    "不变量".to_string(),
                ],
                related_terms: vec!["形式化方法".to_string(), "形式化验证".to_string()],
                confidence: 0.95,
            },
            TermDefinition {
                name: "形式化验证".to_string(),
                english_name: "Formal Verification".to_string(),
                definition: "使用数学方法证明系统满足其规范的过程".to_string(),
                category: TermCategory::FormalMethods,
                source: TermSource::Wikipedia,
                synonyms: vec!["Formal verification".to_string(), "数学验证".to_string()],
                context: "Software Engineering".to_string(),
                examples: vec![
                    "模型检查".to_string(),
                    "定理证明".to_string(),
                    "静态分析".to_string(),
                ],
                related_terms: vec!["形式化方法".to_string(), "形式化规范".to_string()],
                confidence: 0.95,
            },
            TermDefinition {
                name: "模型检查".to_string(),
                english_name: "Model Checking".to_string(),
                definition: "自动验证有限状态系统是否满足给定规范的方法".to_string(),
                category: TermCategory::FormalMethods,
                source: TermSource::Wikipedia,
                synonyms: vec!["Model checking".to_string(), "模型验证".to_string()],
                context: "Formal Verification".to_string(),
                examples: vec![
                    "SPIN模型检查器".to_string(),
                    "NuSMV模型检查器".to_string(),
                    "UPPAAL工具".to_string(),
                ],
                related_terms: vec!["形式化验证".to_string(), "有限状态机".to_string()],
                confidence: 0.95,
            },
            TermDefinition {
                name: "定理证明".to_string(),
                english_name: "Theorem Proving".to_string(),
                definition: "使用形式逻辑证明陈述为真的过程".to_string(),
                category: TermCategory::FormalMethods,
                source: TermSource::Wikipedia,
                synonyms: vec!["Theorem proving".to_string(), "逻辑证明".to_string()],
                context: "Formal Verification".to_string(),
                examples: vec![
                    "Coq证明助手".to_string(),
                    "Isabelle/HOL".to_string(),
                    "PVS系统".to_string(),
                ],
                related_terms: vec!["形式化验证".to_string(), "逻辑系统".to_string()],
                confidence: 0.95,
            },
        ]
    }
}
```

### 2.2 编程语言术语

```rust
/// 编程语言术语数据
pub struct ProgrammingLanguageTerms;

impl ProgrammingLanguageTerms {
    /// 获取Rust相关术语
    pub fn get_rust_terms() -> Vec<TermDefinition> {
        vec![
            TermDefinition {
                name: "所有权系统".to_string(),
                english_name: "Ownership System".to_string(),
                definition: "管理内存分配和释放的机制，确保内存安全".to_string(),
                category: TermCategory::ProgrammingLanguage,
                source: TermSource::OfficialDocument,
                synonyms: vec!["Ownership".to_string(), "内存管理".to_string()],
                context: "Rust Programming Language".to_string(),
                examples: vec![
                    "let x = String::from(\"hello\");".to_string(),
                    "let y = x; // x的所有权移动到y".to_string(),
                ],
                related_terms: vec!["借用检查".to_string(), "生命周期".to_string()],
                confidence: 0.95,
            },
            TermDefinition {
                name: "借用检查".to_string(),
                english_name: "Borrow Checking".to_string(),
                definition: "在编译时检查引用的有效性和安全性的机制".to_string(),
                category: TermCategory::ProgrammingLanguage,
                source: TermSource::OfficialDocument,
                synonyms: vec!["Borrow Checker".to_string(), "引用检查".to_string()],
                context: "Rust Programming Language".to_string(),
                examples: vec![
                    "let mut v = vec![1, 2, 3];".to_string(),
                    "let first = &v[0];".to_string(),
                    "v.push(4); // 编译错误：借用检查失败".to_string(),
                ],
                related_terms: vec!["所有权系统".to_string(), "生命周期".to_string()],
                confidence: 0.95,
            },
            TermDefinition {
                name: "生命周期".to_string(),
                english_name: "Lifetime".to_string(),
                definition: "引用在程序中有效的持续时间".to_string(),
                category: TermCategory::ProgrammingLanguage,
                source: TermSource::OfficialDocument,
                synonyms: vec!["引用生命周期".to_string(), "作用域".to_string()],
                context: "Rust Programming Language".to_string(),
                examples: vec![
                    "fn longest<'a>(x: &'a str, y: &'a str) -> &'a str {{".to_string(),
                    "    if x.len() > y.len() {{ x }} else {{ y }}".to_string(),
                    "}}".to_string(),
                ],
                related_terms: vec!["所有权系统".to_string(), "借用检查".to_string()],
                confidence: 0.95,
            },
        ]
    }

    /// 获取Go相关术语
    pub fn get_go_terms() -> Vec<TermDefinition> {
        vec![
            TermDefinition {
                name: "Goroutine".to_string(),
                english_name: "Goroutine".to_string(),
                definition: "Go语言中的轻量级线程，由Go运行时管理".to_string(),
                category: TermCategory::ProgrammingLanguage,
                source: TermSource::OfficialDocument,
                synonyms: vec!["协程".to_string(), "轻量级线程".to_string()],
                context: "Go Programming Language".to_string(),
                examples: vec![
                    "go func() {{".to_string(),
                    "    fmt.Println(\"Hello from goroutine\")".to_string(),
                    "}}()".to_string(),
                ],
                related_terms: vec!["Channel".to_string(), "并发".to_string()],
                confidence: 0.95,
            },
            TermDefinition {
                name: "Channel".to_string(),
                english_name: "Channel".to_string(),
                definition: "Go语言中用于goroutine间通信的机制".to_string(),
                category: TermCategory::ProgrammingLanguage,
                source: TermSource::OfficialDocument,
                synonyms: vec!["通道".to_string(), "通信通道".to_string()],
                context: "Go Programming Language".to_string(),
                examples: vec![
                    "ch := make(chan int)".to_string(),
                    "ch <- 42 // 发送数据".to_string(),
                    "value := <-ch // 接收数据".to_string(),
                ],
                related_terms: vec!["Goroutine".to_string(), "并发".to_string()],
                confidence: 0.95,
            },
        ]
    }
}
```

## 3. 使用示例

```rust
fn main() -> Result<(), String> {
    // 创建术语数据库
    let mut database = TerminologyDatabase::new();
    
    // 导入形式化方法术语
    let formal_methods_terms = FormalMethodsTerms::get_terms();
    for term in formal_methods_terms {
        database.add_term(term)?;
    }
    
    // 导入编程语言术语
    let rust_terms = ProgrammingLanguageTerms::get_rust_terms();
    for term in rust_terms {
        database.add_term(term)?;
    }
    
    let go_terms = ProgrammingLanguageTerms::get_go_terms();
    for term in go_terms {
        database.add_term(term)?;
    }
    
    // 输出统计信息
    println!("术语数据库统计:");
    println!("- 总术语数: {}", database.term_count());
    
    // 搜索示例
    println!("\n搜索'所有权'的结果:");
    let search_results = database.search_terms("所有权");
    for term in search_results {
        println!("- {} ({})", term.name, term.english_name);
    }
    
    // 按类别查找示例
    println!("\n编程语言类别术语:");
    let programming_terms = database.find_by_category(&TermCategory::ProgrammingLanguage);
    for term in programming_terms {
        println!("- {} ({})", term.name, term.english_name);
    }
    
    Ok(())
}
```

## 4. 总结

本文档实现了术语数据库的核心数据结构，包括：

1. **术语定义结构**：完整的术语定义，包含名称、定义、类别、来源等信息
2. **数据库结构**：支持高效查询和索引的数据库实现
3. **标准术语数据**：预定义的形式化方法和编程语言术语
4. **使用示例**：展示如何创建和使用术语数据库

这个实现为项目的术语统一工作提供了坚实的基础，确保所有概念定义、解释论证和语义都与国际Wiki和学术标准保持一致。
