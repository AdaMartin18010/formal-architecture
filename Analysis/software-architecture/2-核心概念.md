# 软件架构 · 核心概念

## 2.1 定义

- 软件架构：系统在抽象层面的结构描述，包含组件、连接件、约束与其背后的设计原理。
- 视图与观点：通过不同视角（逻辑、开发、进程、部署）描述系统，支撑不同干系人的关切。

## 2.2 质量属性与原则

- 质量属性：可用性、性能、可伸缩性、可靠性、可维护性、安全性、可观测性、可演进性。
- 架构原则：单一职责、关注点分离、接口隔离、明确边界、演进优先、可测试性优先、失败优先。
- 战术：缓存、异步化、幂等性、降级与熔断、读写分离、分区与分片、事件溯源、CQRS。

## 2.3 架构风格与模式

- 分层架构（Layered）：表示、领域、数据访问分层；清晰边界，易演进。
- 端口与适配器（Hexagonal）：领域中心，端口抽象外设，适配器适配实现。
- 微服务（Microservices）：服务自治、独立部署、去中心化数据，强调契约与观测。
- 事件驱动（EDA）：以事件为一等公民，解耦生产与消费，易于扩展与审计。
- 面向服务（SOA）与 API 网关：服务编排、聚合与统一入口，支持跨域策略与治理。

## 2.4 接口契约（示例）

- HTTP（订单创建）：
  - POST /api/v1/orders
  - Request JSON：{ userId, items:[{skuId, qty}], couponId? }
  - Response：201 Created，{ orderId, state:"PENDING", reserved:true }
  - 约束：Idempotency-Key 头；429/503 重试语义；401/403 鉴权
- 事件（支付成功）：
  - topic: payments.success
  - payload：{ paymentId, orderId, amount, currency, paidAt, traceId }
  - 约束：schema 版本化；至少一次投递；幂等键=paymentId

## 2.5 交互时序（概述）

- 下单：Client→API→OrderService→(emit ReserveStock)→Inventory→(emit StockReserved)→OrderService→201
- 支付：Client→PayGateway→PaymentService→(emit PaymentSuccess)→OrderService→(emit OrderPaid)
