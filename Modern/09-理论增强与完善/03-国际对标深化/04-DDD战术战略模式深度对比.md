# DDD 战术/战略模式深度对比

[返回总论](./00-国际对标深化总论.md) | [返回增强总论](../00-理论增强与完善总论.md)

> **文档目标**：对 DDD 战术模式、战略设计模式与 SMDD/MSMFIT 进行逐项深度对比，支持迁移决策与融合路径选择。

---

## 目录

- [1. 战略设计模式深度对比](#1-战略设计模式深度对比)
- [2. 战术模式深度对比](#2-战术模式深度对比)
- [3. 模式映射矩阵](#3-模式映射矩阵)
- [4. 迁移决策树](#4-迁移决策树)
- [2025 对齐](#2025-对齐)

---

## 1. 战略设计模式深度对比

### 1.1 限界上下文（Bounded Context）

| 维度 | DDD | SMDD/MSMFIT | 对比结论 |
|------|-----|-------------|----------|
| **定义方式** | 人工划分、团队共识 | 上下文 C 形式化参数 | SMDD 可自动推导 |
| **边界表达** | 自然语言、上下文图 | DSL 的 context 块 | 形式化、可验证 |
| **映射到 MSMFIT** | - | $C \supseteq \{domain, entities, rules\}$ | 见 [限界上下文自动识别](./03-DDD融合深化.md#4-限界上下文自动识别) |

### 1.2 上下文映射（Context Mapping）

| DDD 模式 | SMDD 对应 | 说明 |
|----------|----------|------|
| **共享内核（Shared Kernel）** | 共享实体 E、关系 R | 通过 MSMFIT 共享子模型 |
| **客户-供应商（Customer-Supplier）** | 关系 R 的方向性 | 上游→下游的语义依赖 |
| **遵奉者（Conformist）** | 单向映射 $f: M_{up} \rightarrow M_{down}$ | 下游遵奉上游语义 |
| **防腐层（ACL）** | 桥接机制、DSL 转换器 | 见 [桥接机制与DSL转换器](../../03-业务语义与技术实现同构理论/02-桥接机制与DSL转换器.md) |
| **开放主机服务（OHS）** | 语义化 API 契约 | 事件驱动语义总线 |
| **发布语言（PL）** | DSL 作为发布语言 | 语义模型即契约 |

### 1.3 子域划分（Subdomain）

| DDD 类型 | MSMFIT 对应 | 说明 |
|----------|-------------|------|
| **核心域** | 高语义密度 E/R/V | 核心业务实体与事件 |
| **支撑域** | 中等语义密度 | 支撑性领域 |
| **通用域** | 低语义密度、可复用 | 通用组件、第三方 |

---

## 2. 战术模式深度对比

### 2.1 实体（Entity）

| 维度 | DDD | SMDD | 映射 |
|------|-----|------|------|
| **定义** | 有唯一标识的领域对象 | MSMFIT 实体 E | $E \ni (id, attributes)$ |
| **生成方式** | 手写 | DSL→代码生成 | 可逆计算正向 |
| **标识** | 显式 ID 设计 | DSL 中 id 字段 | 一一对应 |

### 2.2 值对象（Value Object）

| 维度 | DDD | SMDD | 映射 |
|------|-----|------|------|
| **定义** | 无标识、不可变 | E 的不可变子集或 R 的属性 | 通过 DSL 约束表达 |
| **相等性** | 按值相等 | 结构相等 | 形式化可验证 |

### 2.3 聚合（Aggregate）

| 维度 | DDD | SMDD | 映射 |
|------|-----|------|------|
| **边界** | 一致性边界 | 上下文 C 内的 E/R/V 闭包 | 自动识别算法 |
| **聚合根** | 唯一入口 | 根实体 E_root | 从语义模型生成 |
| **不变式** | 业务规则 | DSL 验证规则、SHACL | 形式化验证 |

### 2.4 领域服务（Domain Service）

| 维度 | DDD | SMDD | 映射 |
|------|-----|------|------|
| **定义** | 无状态、跨聚合 | 事件 V 或关系 R 的复合 | 语义事件编排 |
| **生成** | 手写 | 从语义模型生成 | 可逆计算 |

### 2.5 领域事件（Domain Event）

| 维度 | DDD | SMDD | 映射 |
|------|-----|------|------|
| **定义** | 过去时、不可变 | MSMFIT 事件 V | $V \ni (subject, object, preState, postState)$ |
| **发布** | 聚合内发布 | 语义事件总线 | 事件驱动语义 |

---

## 3. 模式映射矩阵

| DDD 模式 | MSMFIT 要素 | SMDD 实践 | 迁移难度 |
|----------|-------------|-----------|----------|
| 限界上下文 | C（上下文） | context 块 | 低 |
| 实体 | E（实体） | entity 定义 | 低 |
| 值对象 | E 子集 | 不可变约束 | 低 |
| 聚合 | E+R+V 闭包 | 自动识别 | 中 |
| 聚合根 | E_root | 生成 | 低 |
| 领域服务 | V、R 复合 | 生成 | 中 |
| 领域事件 | V（事件） | event 定义 | 低 |
| 仓储 | - | 生成或防腐层 | 中 |
| 工厂 | - | 生成 | 低 |

---

## 4. 迁移决策树

```
DDD 项目迁移决策
├── 战略设计已明确？
│   ├── 是 → 限界上下文→C，上下文映射→R
│   └── 否 → 先完成 DDD 战略设计，再迁移
├── 战术设计已实施？
│   ├── 是 → 实体/聚合→E/R/V，按映射矩阵迁移
│   └── 否 → 可直接用 SMDD 从统一语言构建
└── 遗留代码存在？
    ├── 是 → 防腐层 + 渐进式迁移
    └── 否 → 全量 SMDD 开发
```

---

## 2025 对齐

- **DDD 参考**：Eric Evans《Domain-Driven Design》、Vernon《Implementing DDD》
- **融合指南**：[03-DDD融合深化](./03-DDD融合深化.md)
- **对齐状态**：已完成（最后更新：2025-02-03）

---

**文档版本**：v1.0
**创建日期**：2025-02-03
**维护状态**：✅ 持续更新中
